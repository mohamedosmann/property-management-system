generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CLIENT
}

model User {
  id        String   @id @default(cuid()) @map("_id")
  name      String
  email     String   @unique
  password  String
  image     String?
  role      String   @default("CLIENT") // SQLite doesn't support enums well, simplified to String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  properties                   Property[]           @relation("OwnerProperties")
  rentedProperties             Property[]           @relation("TenantProperties")
  maintenanceRequests          MaintenanceRequest[] @relation("MaintenanceRequests")
  assignedMaintenanceRequests  MaintenanceRequest[] @relation("AssignedMaintenanceRequests")
  invoices                     Invoice[]            @relation("ClientInvoices")
}

model Property {
  id          String @id @default(cuid()) @map("_id")
  title       String
  description String
  location    String
  price       Float
  type        String
  bedrooms    Int
  bathrooms   Int
  squareFeet  Float
  features    String // SQLite doesn't support String[], storing as comma-separated string or JSON
  status      String @default("VACANT")

  rentAmount  Float?
  billingDay  Int?     @default(1)

  ownerId String
  owner   User   @relation("OwnerProperties", fields: [ownerId], references: [id])

  tenantId String?
  tenant   User?   @relation("TenantProperties", fields: [tenantId], references: [id])
   
  invoices Invoice[]

  images              Image[]
  maintenanceRequests MaintenanceRequest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Image {
  id         String   @id @default(cuid()) @map("_id")
  url        String
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model MaintenanceRequest {
  id          String @id @default(cuid()) @map("_id")
  title       String
  description String
  status      String   @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED
  priority    String   @default("MEDIUM")  // LOW, MEDIUM, HIGH
  category    String   @default("GENERAL") // PLUMBING, ELECTRICAL, GENERAL, etc.

  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  tenantId String
  tenant   User   @relation("MaintenanceRequests", fields: [tenantId], references: [id])

  assignedToId String?
  assignedTo   User?   @relation("AssignedMaintenanceRequests", fields: [assignedToId], references: [id])

  images      MaintenanceImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MaintenanceImage {
  id        String   @id @default(cuid()) @map("_id")
  url       String
  requestId String
  request   MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

}

model Invoice {
  id        String   @id @default(cuid()) @map("_id")
  amount    Float
  status    String   @default("UNPAID") // PAID, UNPAID, OVERDUE
  dueDate   DateTime
  paidDate  DateTime?
  pdfUrl    String?
  
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id])

  tenantId String
  tenant   User   @relation("ClientInvoices", fields: [tenantId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
